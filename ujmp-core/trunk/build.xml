<?xml version="1.0"?>
<project name="ujmp-and-jdmp" basedir="." default="run">


	<!--************************************************************************
	*                                                                          *
	*                       Ant Script for UJMP and JDMP                       *	
	*        Universal Java Matrix Package and Java Data Mining Package        *
	*                     Copyright (C) Holger Arndt 2009                      *
	*                           mail@holger-arndt.de                           *
	*                                                                        -->

	<property name="ujmp.version" value="0.2.1" />
	<property name="jdmp.version" value="0.0.3" />

	<!--                                                                       *
	*                                                                          *
	*  This script provides an easy way to check out the source code and       *
	*  build UJMP or JDMP from scratch. See the homepages of the projects for  *
	*  more information: http://www.ujmp.org/ and http://www.jdmp.org/         *
	*                                                                          *
	*  Change this value to match the project you wish to build:             -->

	<property name="default-project" value="jdmp-gui" />

	<!-- ujmp-core      (basic matrix implementations and functions)           *
	*    ujmp-gui       (visualization methods for date in matrix format)      *
	*    jdmp-core      (machine learning algorithms for Samples and Datasets) *
	*    ujmp-gui       (visualization methods for machine learning)           *
	*    ujmp-complete  (everything for matrices, needs lots of dependencies)  *
	*    jdmp-complete  (really everything for matrices and machine learning)  *
	*                                                                          *
	*  You should start from top to bottom, jdmp-complete requires many        *
	*  dependencies and I really mean A LOT! Try ujmp-core first to see if     *
	*  your environment is set up correctly. You need Java 1.6, ant, svn,      *
	*  and a working internet connection to run this ant script.               *
	*                                                                          *
	*  After that you can use the following commands to handle the projects    *
	*  relevant to you:                                                        *
	*                                                                          *
	*    ant checkout         (get the source code from SVN)                   *
	*    ant update           (update the source code from SVN)                *
	*    ant build            (compile the source files to class files)        *
	*    ant package          (create jar files for the selected project)      *
	*    ant run              (run the main method of the selected project)    *
	*    ant clean            (delete the compiled class files)                *
	*    ant clean-all        (delete source, classes and jars)                *
	*    ant clean-libs       (delete downloaded or compiled libraries)        *
	*    ant clean-sources    (delete the source files)                        *
	*                                                                          *
	*  Alternatively, you can specify another project, by invokin e.g.         *
	*    ant package-ujmp-gui    or   ant run-jdmp-core                        *
	*                                                                          *
	*  If you have questions or experience problems, our public forum is a     *
	*  good place to go:                                                       *
	*                                                                          *
	*  http://www.ujmp.org/forum    or    http://www.jdmp.org/forum            *
	*                                                                          *
	*                                                            Have fun!     *
	*                                                                          *
	*************************************************************************-->


	<property name="src.dir" value="src/main/java" />
	<property name="build.dir" value="build" />
	<property name="classes.dir" value="${build.dir}/classes" />
	<property name="jar.dir" value="${build.dir}/jar" />
	<property name="lib.dir" value="lib" />

	<property name="ujmp.svn" value="https://ujmp.svn.sourceforge.net/svnroot/ujmp" />
	<property name="jdmp.svn" value="https://jdmp.svn.sourceforge.net/svnroot/jdmp" />

	<property name="ujmp-core.main-class" value="org.ujmp.core.UJMP" />
	<property name="ujmp-gui.main-class" value="org.ujmp.gui.UJMP" />
	<property name="jdmp-core.main-class" value="org.jdmp.core.JDMP" />
	<property name="jdmp-gui.main-class" value="org.jdmp.gui.JDMP" />

	<property name="junit.url" value="http://downloads.sourceforge.net/junit/junit-4.5.jar" />
	<property name="junit.name" value="junit.jar" />

	<property name="author" value="Holger Arndt" />


	<target name="jdmp-complete-libraries" depends="junit,ujmp-core,ujmp-gui,jdmp-core,jdmp-gui" />
	<target name="jdmp-core-libraries" depends="junit,ujmp-core" />
	<target name="jdmp-gui-libraries" depends="junit,ujmp-core,ujmp-gui,jdmp-core" />

	<target name="ujmp-complete-libraries" depends="junit,ujmp-core,ujmp-gui" />
	<target name="ujmp-core-libraries" depends="junit" />
	<target name="ujmp-gui-libraries" depends="junit,ujmp-core" />




	<target name="checkout">
		<antcall target="checkout-${default-project}">
		</antcall>
	</target>
	<target name="update">
		<antcall target="update-${default-project}">
		</antcall>
	</target>
	<target name="build">
		<antcall target="build-${default-project}">
		</antcall>
	</target>
	<target name="package">
		<antcall target="package-${default-project}">
		</antcall>
	</target>
	<target name="run">
		<antcall target="run-${default-project}">
		</antcall>
	</target>



	<target name="init" depends="create-directories,find-libraries,find-sources" />


	<target name="create-directories">
		<mkdir dir="${lib.dir}" />
	</target>



	<target name="clean-all" depends="clean-sources,clean-libs,clean" />

	<target name="clean">
		<delete dir="${build.dir}" />
	</target>

	<target name="clean-sources">
		<delete dir="ujmp-core" />
		<delete dir="ujmp-gui" />
		<delete dir="jdmp-core" />
		<delete dir="jdmp-gui" />
	</target>


	<target name="clean-libs">
		<delete dir="${lib.dir}" />
	</target>




	<target name="build-ujmp-core" depends="checkout-ujmp-core,ujmp-core-libraries" unless="ujmp-core-lib.exists">
		<mkdir dir="${classes.dir}" />
		<path id="classpath">
			<fileset dir="${lib.dir}" includes="**/*.jar" />
		</path>
		<javac compiler="javac1.6" srcdir="ujmp-core" destdir="${classes.dir}" classpathref="classpath" />
	</target>

	<target name="build-ujmp-gui" depends="checkout-ujmp-gui,ujmp-gui-libraries" unless="ujmp-gui-lib.exists">
		<mkdir dir="${classes.dir}" />
		<path id="classpath">
			<fileset dir="${lib.dir}" includes="**/*.jar" />
		</path>
		<javac compiler="javac1.6" srcdir="ujmp-gui" destdir="${classes.dir}" classpathref="classpath" />
	</target>

	<target name="build-jdmp-core" depends="checkout-jdmp-core,jdmp-core-libraries" unless="jdmp-core-lib.exists">
		<mkdir dir="${classes.dir}" />
		<path id="classpath">
			<fileset dir="${lib.dir}" includes="**/*.jar" />
		</path>
		<javac compiler="javac1.6" srcdir="jdmp-core" destdir="${classes.dir}" classpathref="classpath" />
		<copy file="jdmp-core/src/main/java/org/jdmp/core/script/jdmp/lexer/lexer.dat" tofile="${classes.dir}/org/jdmp/core/script/jdmp/lexer/lexer.dat" />
		<copy file="jdmp-core/src/main/java/org/jdmp/core/script/jdmp/parser/parser.dat" tofile="${classes.dir}/org/jdmp/core/script/jdmp/parser/parser.dat" />
	</target>

	<target name="build-jdmp-gui" depends="checkout-jdmp-gui,jdmp-gui-libraries" unless="jdmp-gui-lib.exists">
		<mkdir dir="${classes.dir}" />
		<path id="classpath">
			<fileset dir="${lib.dir}" includes="**/*.jar" />
		</path>
		<javac compiler="javac1.6" srcdir="jdmp-gui" destdir="${classes.dir}" classpathref="classpath" />
	</target>




	<target name="ujmp-core" depends="init,build-ujmp-core" unless="ujmp-core-lib.exists">
		<mkdir dir="${jar.dir}" />
		<jar destfile="${jar.dir}/ujmp-core-${ujmp.version}.jar" basedir="${classes.dir}">
			<manifest>
				<attribute name="Main-Class" value="${ujmp-core.main-class}" />
				<attribute name="Package-Title" value="ujmp-core" />
				<attribute name="Package-Version" value="${ujmp.version}" />
				<attribute name="Package-Vendor" value="${author}" />
			</manifest>
		</jar>
	</target>

	<target name="ujmp-gui" depends="init,build-ujmp-gui" unless="ujmp-gui-lib.exists">
		<mkdir dir="${jar.dir}" />
		<jar destfile="${jar.dir}/ujmp-gui-${ujmp.version}.jar" basedir="${classes.dir}">
			<manifest>
				<attribute name="Main-Class" value="${ujmp-gui.main-class}" />
				<attribute name="Package-Title" value="ujmp-gui" />
				<attribute name="Package-Version" value="${ujmp.version}" />
				<attribute name="Package-Vendor" value="${author}" />
			</manifest>
		</jar>
	</target>

	<target name="jdmp-core" depends="init,build-jdmp-core" unless="jdmp-core-lib.exists">
		<mkdir dir="${jar.dir}" />
		<jar destfile="${jar.dir}/jdmp-core-${jdmp.version}.jar" basedir="${classes.dir}">
			<manifest>
				<attribute name="Main-Class" value="${jdmp-core.main-class}" />
				<attribute name="Package-Title" value="jdmp-core" />
				<attribute name="Package-Version" value="${jdmp.version}" />
				<attribute name="Package-Vendor" value="${author}" />
			</manifest>
		</jar>
	</target>

	<target name="jdmp-gui" depends="init,build-jdmp-gui" unless="jdmp-gui-lib.exists">
		<mkdir dir="${jar.dir}" />
		<jar destfile="${jar.dir}/jdmp-gui-${jdmp.version}.jar" basedir="${classes.dir}">
			<manifest>
				<attribute name="Main-Class" value="${jdmp-gui.main-class}" />
				<attribute name="Package-Title" value="jdmp-core" />
				<attribute name="Package-Version" value="${jdmp.version}" />
				<attribute name="Package-Vendor" value="${author}" />
			</manifest>
		</jar>
	</target>




	<target name="run-ujmp-core" depends="ujmp-core">
		<java jar="${jar.dir}/ujmp-core-${ujmp.version}.jar" fork="true" />
	</target>

	<target name="run-ujmp-gui" depends="ujmp-gui">
		<java jar="${jar.dir}/ujmp-gui-${ujmp.version}.jar" fork="true" />
	</target>

	<target name="run-jdmp-core" depends="jdmp-core">
		<java jar="${jar.dir}/jdmp-core-${jdmp.version}.jar" fork="true" />
	</target>

	<target name="run-jdmp-gui" depends="jdmp-gui">
		<java jar="${jar.dir}/jdmp-gui-${jdmp.version}.jar" fork="true" />
	</target>



	<target name="checkout-ujmp-core" depends="init" unless="ujmp-core-source.exists">
		<echo>Checking out source code from SVN, please be patient</echo>
		<exec executable="svn">
			<arg value="co" />
			<arg value="${ujmp.svn}/ujmp-core/trunk" />
			<arg value="ujmp-core" />
		</exec>
	</target >

	<target name="checkout-ujmp-gui" depends="init,checkout-ujmp-core" unless="ujmp-gui-source.exists">
		<echo>Checking out source code from SVN, please be patient</echo>
		<exec executable="svn">
			<arg value="co" />
			<arg value="${ujmp.svn}/ujmp-gui/trunk" />
			<arg value="ujmp-gui" />
		</exec>
	</target >

	<target name="checkout-jdmp-core" depends="init,checkout-ujmp-core" unless="jdmp-core-source.exists">
		<echo>Checking out source code from SVN, please be patient</echo>
		<exec executable="svn">
			<arg value="co" />
			<arg value="${jdmp.svn}/jdmp-core/trunk" />
			<arg value="jdmp-core" />
		</exec>
	</target >

	<target name="checkout-jdmp-gui" depends="init,checkout-jdmp-core,checkout-ujmp-core,checkout-ujmp-gui" unless="jdmp-gui-source.exists">
		<echo>Checking out source code from SVN, please be patient</echo>
		<exec executable="svn">
			<arg value="co" />
			<arg value="${jdmp.svn}/jdmp-gui/trunk" />
			<arg value="jdmp-gui" />
		</exec>
	</target >




	<target name="update-ujmp-core" depends="checkout-ujmp-core">
		<echo>Updating source code from SVN, please be patient</echo>
		<exec executable="svn">
			<arg value="update" />
			<arg value="${ujmp.svn}/ujmp-core/trunk" />
			<arg value="ujmp-core" />
		</exec>
	</target >

	<target name="update-ujmp-gui" depends="checkout-ujmp-gui,update-ujmp-core">
		<echo>Updating source code from SVN, please be patient</echo>
		<exec executable="svn">
			<arg value="update" />
			<arg value="${ujmp.svn}/ujmp-gui/trunk" />
			<arg value="ujmp-gui" />
		</exec>
	</target >

	<target name="update-jdmp-core" depends="checkout-jdmp-core,update-ujmp-core">
		<echo>Updating source code from SVN, please be patient</echo>
		<exec executable="svn">
			<arg value="update" />
			<arg value="${jdmp.svn}/jdmp-core/trunk" />
			<arg value="jdmp-core" />
		</exec>
	</target >

	<target name="update-jdmp-gui" depends="checkout-jdmp-gui,update-jdmp-core,update-ujmp-core,update-ujmp-gui">
		<echo>Updating source code from SVN, please be patient</echo>
		<exec executable="svn">
			<arg value="update" />
			<arg value="${jdmp.svn}/jdmp-gui/trunk" />
			<arg value="jdmp-gui" />
		</exec>
	</target >








	<target name="find-libraries">
		<available file="${jar.dir}/ujmp-core-${ujmp.version}.jar" property="ujmp-core-lib.exists" />
		<available file="${jar.dir}/ujmp-gui-${ujmp.version}.jar" property="ujmp-gui-lib.exists" />
		<available file="${jar.dir}/jdmp-core-${jdmp.version}.jar" property="jdmp-core-lib.exists" />
		<available file="${jar.dir}/jdmp-gui-${jdmp.version}.jar" property="jdmp-gui-lib.exists" />
		<available file="${lib.dir}/${junit.name}" property="junit.exists" />
	</target>

	<target name="find-sources">
		<available file="ujmp-core" property="ujmp-core-source.exists" />
		<available file="ujmp-gui" property="ujmp-gui-source.exists" />
		<available file="jdmp-core" property="jdmp-core-source.exists" />
		<available file="jdmp-gui" property="jdmp-gui-source.exists" />
	</target>



	<target name="junit" depends="init" unless="junit.exists">
		<get src="${junit.url}" dest="${lib.dir}/${junit.name}" />
	</target>


</project>
